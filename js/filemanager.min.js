function error(e){console.log(e)}function open_dir(e){$("body").addClass("loading"),manager.get_dir(e,function(e){global.total_selected=0,$("#edit").hide(),html="";for(var t=0;t<e.length;t++)html+='<div data-file="'+e[t].rel_filename+'" class="file '+e[t].type+'"title="'+e[t].filename+'" data-i="'+t+'" data-type="'+e[t].type+'"><div class="icon"><i class="fa fa-'+e[t].icon+'"></i></div><div class="name">'+e[t].filename+'</div><div class="type">'+e[t].type+'</div><div class="filedate" data-date="'+e[t].modified_timestamp+'">'+e[t].date+'</div><div class="filesize" data-size="'+e[t].raw_size+'">'+e[t].filesize+"</div></div>";$(".file").remove(),$("#files").html(html),$("#info").text(e.length+" file(s)"),$("#files").off("click").on("click",function(t){$(t.target).closest(".file").length||($(".selected").removeClass("selected"),$("#info").text(e.length+" file(s)"),$("#edit").hide())}),$(".file").on("click",function(e){var t=parseInt($(this).data("i")),i="";if(!e.ctrlKey){if($(this).hasClass("selected"))return;$(".selected").removeClass("selected")}if(e.shiftKey){if(t>global.last_selected)for(;t>=global.last_selected;)$('.file[data-i="'+t+'"]').addClass("selected"),t--;else for(;t<=global.last_selected;)$('.file[data-i="'+t+'"]').addClass("selected"),t++;$(this).addClass("selected"),global.total_selected=$(".selected").length,i=global.total_selected+" files selected"}else e.ctrlKey?($(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected"),global.total_selected=$(".selected").length,i=global.total_selected+" files selected"):(global.last_selected=t,$(this).addClass("selected"),global.total_selected=1,console.log(manager.files[t]),i=manager.files[t].rel_filename,"dir"!==manager.files[t].type&&(i+=" - Size:"+manager.files[t].filesize),i+=" - Modified:"+manager.files[t].modified);$("#info").text(i),1===global.total_selected?$("#edit .single").show():$("#edit .single").hide(),global.total_selected>0?$("#edit").show():$("#edit").hide()}),$('.file[data-type!="dir"]').on("dblclick",function(){var e=$(this).data("i");if("undefined"!=typeof e){manager.files[e];$("#image").html(""),$("#text textarea").html(""),manager.get_file(e,function(e){e?(console.log(e),$("#image").hide(),$("#text").hide(),$("#iframe").hide(),"view"==e.action?"jpg"===e.type||"gif"===e.type||"png"===e.type?($("#image").html('<img src="'+global.base_url+e.rel_filename+'">'),$("#image").show(),lightbox.show(e.filename)):(console.log(global.base_url+encodeURIComponent(e.rel_filename)),window.open(global.base_url+encodeURIComponent(e.rel_filename))):"edit"==e.action?($("#text textarea").text(e.contents),$("#text").show(),lightbox.show(e.filename)):$("#iframe iframe").attr("src","download.php?file="+encodeURIComponent(e.rel_filename))):error("This type of file is not permitted.")})}}),$(".dir").on("dblclick",function(){open_dir($(this).data("file"))}),manager.get_breadcrumbs(function(e){html="";for(var t=0;t<e.length;t++)html+='<li><a data-path="'+e[t].rel_path+'">'+e[t].name+"</a></li>";$(".breadcrumb li").remove(),$(".breadcrumb").html(html),$(".breadcrumb li a").on("click",function(){open_dir($(this).data("path"))}),$("body").removeClass("loading")})})}function search(e){if("undefined"==typeof e)return $("#searchclear").hide(),void $(".file").show();if(""===e)return $("#searchclear").hide(),void $(".file").show();$("#searchclear").show();var t="";$(".file").hide();for(var i=0;i<manager.files.length;i++)-1!==manager.files[i].filename.search(e)&&(t+='.file[data-i="'+i+'"],');$(t.slice(0,-1)).show()}var lightbox={init:function(){$(".lightbox-close").on("click",this.hide),$("#fade").on("click",this.hide)},show:function(e){"string"==typeof e?$(".lightbox-header").html(e):($(".lightbox-header").html(""),$(".lightbox-header").hide()),$(".lightbox").fadeIn(),$("#fade").fadeIn()},hide:function(){$(".lightbox").hide(),$("#fade").hide()}},prompt={is_alert:!1,is_init:!1,show:function(e,t,i){var a={},l={};"string"==typeof e&&($("#prompt .text").html(e),prompt.is_init||$(".input").keypress(function(e){13==e.which&&$('#prompt [data-func="ok"]').trigger("click")}),a=$.extend({text:"OK",action:this.hide},t),l=$.extend({text:"Cancel",action:this.hide},i),$('#prompt [data-func="ok"]').text(a.text),$('#prompt [data-func="cancel"]').text(l.text),$('#prompt [data-func="ok"]').off("click").on("click",function(){a.action($("#prompt .input input").val()),prompt.hide()}),$('#prompt [data-func="cancel"]').off("click").on("click",l.action),prompt.is_alert?$("#prompt .input").hide():$("#prompt .input").show(),$("#prompt").slideDown())},hide:function(){prompt.is_alert=!1,$("#prompt").slideUp(200),$("#prompt .input input").val("")},alert:function(e,t,i){prompt.is_alert=!0,prompt.show(e,t,i)},set_value:function(e){$("#prompt .input input").val(e)}},manager={dir:"",files:{},nav:{},error:"",get_dir:function(e,t){"undefined"==typeof e&&(e="/"),this.dir=e,data={action:"get_dir",dir:this.dir},$.post("index.php",data,function(e){try{manager.files=JSON.parse(e),"undefined"!=typeof t&&t(manager.files)}catch(i){return!1}})},get_breadcrumbs:function(e){data={action:"get_nav",dir:this.dir},$.post("index.php",data,function(t){try{manager.nav=JSON.parse(t),"undefined"!=typeof e&&e(manager.nav)}catch(i){return!1}})},get_file:function(e,t){data={action:"check_file",dir:this.dir,file:manager.files[e].filename},$.post("index.php",data,function(e){console.log(e);try{"undefined"!=typeof t&&t(JSON.parse(e))}catch(i){return!1}})},new_dir:function(e,t){for(var i=0;i<this.files.length;i++)if(this.files[i].filename===e)return this.error="This folder already exists",!1;data={action:"new_dir",dir:this.dir,name:e},$.post("index.php",data,function(e){try{"undefined"!=typeof t&&t(JSON.parse(e))}catch(i){return!1}})},new_file:function(e,t){for(var i=0;i<this.files.length;i++)if(this.files[i].filename===e)return this.error="This file already exists",!1;data={action:"new_file",dir:this.dir,name:e},$.post("index.php",data,function(e){console.log(e);try{"undefined"!=typeof t&&t(JSON.parse(e))}catch(i){return!1}})},rename:function(e,t,i){for(var a=0;a<this.files.length;a++)if(this.files[a].filename===t)return this.error="This file already exists",!1;data={action:"rename",dir:this.dir,file:manager.files[e].filename,name:t},$.post("index.php",data,function(a){console.log(a);try{manager.files[e].filename=t,"undefined"!=typeof i&&i(JSON.parse(a))}catch(l){return!1}})},"delete":function(e,t){var i=[];if("undefined"!=typeof e&&0!==e.length){for(var a=0;a<e.length;a++)i.push(manager.files[e[a]].filename);data={action:"delete",dir:this.dir,file:i},$.post("index.php",data,function(i){console.log(i);try{delete manager.files[e],"undefined"!=typeof t&&t(JSON.parse(i))}catch(a){return!1}})}},update_file:function(e,t){"undefined"==typeof t&&(t={}),this.files[e]=$.extend(this.files[e],t)}},global={last_selected:999,total_selected:0,get_query:function(){if("undefined"==typeof this.querystring){var e=location.search.slice(1).split("&"),t={};e.forEach(function(e){e=e.split("="),t[e[0]]=decodeURIComponent(e[1]||"")}),this.querystring=JSON.parse(JSON.stringify(t))}return this.querystring}};$(document).ready(function(){global.base_url=base_url,dir=global.get_query().dir,delete base_url,$("#view button").on("click",function(){var e=$(this).data("view");$("#files").attr("class",e),localStorage.view=e}),$("#new_dir").on("click",function(){prompt.show("Enter the name you want for your new directory.",{action:function(e){console.log(e),manager.new_dir(e,function(){open_dir(manager.dir)})||error(manager.error)}})}),$("#new_file").on("click",function(){prompt.show("Enter the name you want for your new file.",{action:function(e){manager.new_file(e,function(){open_dir(manager.dir)})||error(manager.error)}})}),$('#edit button[data-action="rename"]').on("click",function(){1===global.total_selected&&(prompt.set_value(manager.files[$(".selected").data("i")].filename),prompt.show("Enter the new name you want for your file.",{action:function(e){manager.rename($(".selected").data("i"),e,function(){console.log("renamed"),$('.file[data-i="'+$(".selected").data("i")+'"] .name').text(e)})||error(manager.error)}}))}),$('#edit button[data-action="delete"]').on("click",function(){prompt.set_value(manager.files[$(".selected").data("i")].filename),prompt.alert("Are you sure you want to delete these files? All files within selected folders will also be deleted.",{action:function(){var e=$(".selected").map(function(){return $(this).data("i")}).get();manager["delete"](e,function(){console.log("deleted"),open_dir(manager.dir)})||error(manager.error)}})}),$("#upload").on("click",function(){console.log("click"),$('#file_upload input[type="file"]').trigger("click")}),$('#file_upload input[type="file"]').on("change",function(){$('#file_upload input[name="dir"]').val(manager.dir),$("#file_upload form").submit()}),$("#file_upload form").on("submit",function(e){$("#iframe_up").on("load",function(){console.log($("#iframe_up").contents()[0].body.innerHTML),$('#file_upload input[type="file"]').val(""),$("#iframe_up").off("load")})}),$('#search input[type="text"]').on("keyup",function(){search(this.value)}),$("#search button").on("click",function(){search($('#search input[type="text"]').val())}),$("#searchclear").click(function(){$('#search input[type="text"]').val(""),search()}),"undefined"!=typeof localStorage.view&&$("#files").attr("class",localStorage.view),open_dir(dir),lightbox.init()});